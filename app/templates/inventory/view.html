{% extends "layouts/base.html" %}

{% block title %}商品详情 - {{ product.name }} - NEXUS{% endblock %}
{% block breadcrumb %}量子仓储 / 商品详情{% endblock %}

{% block content %}
<div class="product-detail-page">
    <!-- 返回按钮 -->
    <div class="back-nav">
        <a href="{{ url_for('inventory.index') }}" class="back-link">
            <i class="fas fa-arrow-left"></i>
            <span>返回商品列表</span>
        </a>
    </div>
    
    <!-- 主要内容区 -->
    <div class="detail-grid">
        <!-- 左侧 - 商品信息 -->
        <div class="detail-main">
            <!-- 商品卡片 -->
            <div class="product-card">
                <div class="card-header">
                    <div class="product-icon-lg">
                        <i class="fas fa-cube"></i>
                        <div class="icon-pulse"></div>
                    </div>
                    <div class="product-header-info">
                        <div class="product-badges">
                            <span class="sku-badge"><i class="fas fa-barcode"></i> {{ product.sku }}</span>
                            <span class="id-badge">#{{ product.id }}</span>
                        </div>
                        <h1 class="product-name">{{ product.name }}</h1>
                        <div class="product-meta">
                            <span class="meta-item">
                                <i class="fas fa-folder"></i>
                                {{ product.category.name if product.category else '未分类' }}
                            </span>
                            <span class="meta-item">
                                <i class="fas fa-calendar"></i>
                                {{ product.created_at.strftime('%Y-%m-%d') if product.created_at else 'N/A' }}
                            </span>
                        </div>
                    </div>
                    <div class="header-actions">
                        <a href="{{ url_for('inventory.edit', product_id=product.id) }}" class="action-btn primary">
                            <i class="fas fa-pen"></i>
                            编辑商品
                        </a>
                    </div>
                </div>
                
                <!-- 描述 -->
                {% if product.description %}
                <div class="product-description">
                    <h3><i class="fas fa-align-left"></i> 商品描述</h3>
                    <p>{{ product.description }}</p>
                </div>
                {% endif %}
                
                <!-- 标签 -->
                {% if product.tags %}
                <div class="product-tags">
                    <h3><i class="fas fa-tags"></i> 商品标签</h3>
                    <div class="tags-container">
                        {% for tag in product.tags %}
                        <span class="tag-item" style="--tag-color: {{ tag.color }}">
                            {{ tag.name }}
                        </span>
                        {% endfor %}
                    </div>
                </div>
                {% endif %}
            </div>
            
            <!-- 价格信息 -->
            <div class="info-card">
                <div class="card-title">
                    <i class="fas fa-dollar-sign"></i>
                    价格信息
                </div>
                <div class="price-grid">
                    <div class="price-item">
                        <span class="price-label">成本价</span>
                        <span class="price-value cost">¥{{ "%.2f"|format(product.cost) }}</span>
                    </div>
                    <div class="price-item">
                        <span class="price-label">零售价</span>
                        <span class="price-value sell">¥{{ "%.2f"|format(product.price) }}</span>
                    </div>
                    <div class="price-item">
                        <span class="price-label">利润率</span>
                        {% set margin = ((product.price - product.cost) / product.cost * 100) if product.cost > 0 else 0 %}
                        <span class="price-value margin">{{ "%.1f"|format(margin) }}%</span>
                    </div>
                    <div class="price-item">
                        <span class="price-label">单件利润</span>
                        <span class="price-value profit">¥{{ "%.2f"|format(product.price - product.cost) }}</span>
                    </div>
                </div>
            </div>
            
            <!-- 库存记录 -->
            <div class="info-card">
                <div class="card-title">
                    <i class="fas fa-history"></i>
                    库存变动记录
                </div>
                <div class="stock-history">
                    {% if stock_movements %}
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th>时间</th>
                                <th>仓库</th>
                                <th>类型</th>
                                <th>数量</th>
                                <th>操作人</th>
                                <th>备注</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for movement in stock_movements %}
                            <tr>
                                <td class="time-cell">{{ movement.created_at.strftime('%m-%d %H:%M') }}</td>
                                <td>{{ movement.warehouse.name if movement.warehouse else '-' }}</td>
                                <td>
                                    {% if movement.move_type == 'inbound' %}
                                    <span class="type-badge in"><i class="fas fa-arrow-down"></i> 入库</span>
                                    {% else %}
                                    <span class="type-badge out"><i class="fas fa-arrow-up"></i> 出库</span>
                                    {% endif %}
                                </td>
                                <td class="qty-cell {{ 'positive' if movement.qty_change > 0 else 'negative' }}">
                                    {{ '+' if movement.qty_change > 0 else '' }}{{ movement.qty_change }}
                                </td>
                                <td>{{ movement.operator.username if movement.operator else '-' }}</td>
                                <td class="remark-cell">{{ movement.remark or '-' }}</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                    {% else %}
                    <div class="empty-history">
                        <i class="fas fa-inbox"></i>
                        <p>暂无库存变动记录</p>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
        
        <!-- 右侧 - 库存状态 -->
        <div class="detail-sidebar">
            <!-- 总库存 -->
            <div class="stock-overview-card">
                <div class="overview-header">
                    <i class="fas fa-warehouse"></i>
                    <span>库存总览</span>
                </div>
                <div class="total-stock">
                    <span class="stock-number">{{ product.total_stock }}</span>
                    <span class="stock-unit">件</span>
                </div>
                {% set stock_status = 'critical' if product.total_stock <= 20 else 'low' if product.total_stock <= 50 else 'normal' %}
                <div class="stock-status {{ stock_status }}">
                    {% if stock_status == 'normal' %}
                    <i class="fas fa-check-circle"></i> 库存充足
                    {% elif stock_status == 'low' %}
                    <i class="fas fa-exclamation-triangle"></i> 库存偏低
                    {% else %}
                    <i class="fas fa-times-circle"></i> 库存紧张
                    {% endif %}
                </div>
                <div class="stock-bar-lg">
                    {% set stock_percent = (product.total_stock / 500 * 100)|int %}
                    <div class="bar-fill {{ stock_status }}" style="width: {{ [stock_percent, 100]|min }}%;"></div>
                </div>
            </div>
            
            <!-- 分仓库存 -->
            <div class="warehouse-stocks-card">
                <div class="card-title">
                    <i class="fas fa-building"></i>
                    分仓库存
                </div>
                <div class="warehouse-list">
                    {% for stock in product.stocks %}
                    <div class="warehouse-item">
                        <div class="warehouse-info">
                            <span class="warehouse-name">{{ stock.warehouse.name }}</span>
                            <span class="warehouse-location">{{ stock.warehouse.location or '-' }}</span>
                        </div>
                        <div class="warehouse-qty">
                            <span class="qty-value">{{ stock.quantity }}</span>
                            <span class="qty-unit">件</span>
                        </div>
                    </div>
                    {% else %}
                    <div class="empty-warehouse">
                        <p>暂无分仓数据</p>
                    </div>
                    {% endfor %}
                </div>
            </div>
            
            <!-- 快捷操作 -->
            <div class="quick-actions-card">
                <div class="card-title">
                    <i class="fas fa-bolt"></i>
                    快捷操作
                </div>
                <div class="actions-list">
                    <button class="quick-action-btn" onclick="openAdjustModal()">
                        <i class="fas fa-exchange-alt"></i>
                        <span>库存调拨</span>
                    </button>
                    <a href="{{ url_for('inventory.edit', product_id=product.id) }}" class="quick-action-btn">
                        <i class="fas fa-pen"></i>
                        <span>编辑信息</span>
                    </a>
                    <button class="quick-action-btn" onclick="printBarcode()">
                        <i class="fas fa-barcode"></i>
                        <span>打印条码</span>
                    </button>
                    <button class="quick-action-btn danger" onclick="confirmDelete()">
                        <i class="fas fa-trash"></i>
                        <span>删除商品</span>
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block modals %}
<!-- 库存调拨模态框 -->
<div id="adjustModal" class="modal-overlay">
    <div class="adjust-modal">
        <div class="modal-header">
            <div class="modal-icon">
                <i class="fas fa-exchange-alt"></i>
            </div>
            <h3>库存调拨指令</h3>
            <button type="button" class="modal-close" onclick="closeAdjustModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        
        <div class="modal-target">
            <span class="target-label">目标商品</span>
            <span class="target-name">{{ product.name }}</span>
        </div>
        
        <form method="POST" action="{{ url_for('inventory.view', product_id=product.id) }}" class="adjust-form">
            {{ adjust_form.hidden_tag() }}
            
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-warehouse"></i> 操作仓库
                </label>
                {{ adjust_form.warehouse_id(class="form-input") }}
            </div>
            
            <div class="form-row">
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-arrows-alt-h"></i> 操作类型
                    </label>
                    {{ adjust_form.move_type(class="form-input") }}
                </div>
                <div class="form-group">
                    <label class="form-label">
                        <i class="fas fa-sort-numeric-up"></i> 数量
                    </label>
                    {{ adjust_form.quantity(class="form-input") }}
                </div>
            </div>
            
            <div class="form-group">
                <label class="form-label">
                    <i class="fas fa-comment"></i> 备注说明
                </label>
                {{ adjust_form.remark(class="form-input", placeholder="如：季度盘点损耗") }}
            </div>
            
            <div class="modal-actions">
                {{ adjust_form.submit(class="submit-btn") }}
                <button type="button" class="cancel-btn" onclick="closeAdjustModal()">取消</button>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block styles %}
<style>
.product-detail-page {
    padding: 0 0.5rem;
    animation: fadeIn 0.5s ease;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

/* 返回导航 */
.back-nav {
    margin-bottom: 1.5rem;
}

.back-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.5rem 1rem;
    background: var(--bg-surface);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    color: var(--text-muted);
    text-decoration: none;
    transition: all 0.3s ease;
}

.back-link:hover {
    border-color: var(--color-primary);
    color: var(--color-primary);
}

/* 网格布局 */
.detail-grid {
    display: grid;
    grid-template-columns: 1fr 340px;
    gap: 1.5rem;
}

/* 商品卡片 */
.product-card {
    background: var(--bg-surface);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.05);
    overflow: hidden;
    margin-bottom: 1.5rem;
}

.product-card .card-header {
    display: flex;
    align-items: flex-start;
    gap: 1.25rem;
    padding: 1.5rem;
    background: linear-gradient(135deg, rgba(99,102,241,0.1), transparent);
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.product-icon-lg {
    position: relative;
    width: 72px;
    height: 72px;
    background: linear-gradient(135deg, var(--color-primary), #8b5cf6);
    border-radius: 16px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.75rem;
    color: white;
    flex-shrink: 0;
}

.icon-pulse {
    position: absolute;
    inset: -4px;
    border-radius: 20px;
    border: 2px solid var(--color-primary);
    opacity: 0.4;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { transform: scale(1); opacity: 0.4; }
    50% { transform: scale(1.1); opacity: 0.2; }
}

.product-header-info {
    flex: 1;
}

.product-badges {
    display: flex;
    gap: 0.5rem;
    margin-bottom: 0.5rem;
}

.sku-badge, .id-badge {
    padding: 0.25rem 0.75rem;
    background: rgba(255,255,255,0.1);
    border-radius: 6px;
    font-size: 0.75rem;
    font-family: monospace;
    color: var(--text-muted);
}

.sku-badge i {
    margin-right: 0.35rem;
    color: var(--color-primary);
}

.product-name {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-main);
    margin: 0 0 0.5rem;
}

.product-meta {
    display: flex;
    gap: 1rem;
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.35rem;
    font-size: 0.85rem;
    color: var(--text-muted);
}

.meta-item i {
    color: var(--color-primary);
}

.header-actions {
    flex-shrink: 0;
}

.action-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.25rem;
    border-radius: 10px;
    font-size: 0.9rem;
    font-weight: 500;
    text-decoration: none;
    transition: all 0.3s ease;
}

.action-btn.primary {
    background: linear-gradient(135deg, var(--color-primary), #8b5cf6);
    color: white;
}

.action-btn.primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 20px var(--color-primary-glow);
}

/* 描述和标签 */
.product-description, .product-tags {
    padding: 1.25rem 1.5rem;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.product-description h3, .product-tags h3 {
    font-size: 0.85rem;
    font-weight: 600;
    color: var(--text-muted);
    margin: 0 0 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.product-description h3 i, .product-tags h3 i {
    color: var(--color-primary);
}

.product-description p {
    color: var(--text-main);
    line-height: 1.6;
    margin: 0;
}

.tags-container {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.tag-item {
    padding: 0.35rem 0.85rem;
    border: 1px solid var(--tag-color, var(--text-muted));
    border-radius: 20px;
    font-size: 0.8rem;
    color: var(--tag-color, var(--text-muted));
}

/* 信息卡片 */
.info-card {
    background: var(--bg-surface);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.05);
    padding: 1.5rem;
    margin-bottom: 1.5rem;
}

.card-title {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 1rem;
    font-weight: 600;
    color: var(--text-main);
    margin-bottom: 1.25rem;
}

.card-title i {
    color: var(--color-primary);
}

/* 价格网格 */
.price-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 1rem;
}

.price-item {
    text-align: center;
    padding: 1rem;
    background: rgba(255,255,255,0.03);
    border-radius: 12px;
}

.price-label {
    display: block;
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
}

.price-value {
    font-size: 1.25rem;
    font-weight: 700;
}

.price-value.cost { color: var(--text-muted); }
.price-value.sell { color: var(--text-main); }
.price-value.margin { color: #10b981; }
.price-value.profit { color: var(--color-primary); }

/* 历史表格 */
.history-table {
    width: 100%;
    border-collapse: collapse;
}

.history-table th {
    padding: 0.75rem;
    text-align: left;
    font-size: 0.75rem;
    font-weight: 600;
    text-transform: uppercase;
    color: var(--text-muted);
    border-bottom: 1px solid rgba(255,255,255,0.1);
}

.history-table td {
    padding: 0.75rem;
    font-size: 0.85rem;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.time-cell {
    font-family: monospace;
    color: var(--text-muted);
}

.type-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.3rem;
    padding: 0.25rem 0.6rem;
    border-radius: 6px;
    font-size: 0.75rem;
}

.type-badge.in {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
}

.type-badge.out {
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
}

.qty-cell {
    font-weight: 600;
}

.qty-cell.positive { color: #10b981; }
.qty-cell.negative { color: #ef4444; }

.remark-cell {
    color: var(--text-muted);
    max-width: 200px;
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
}

.empty-history {
    text-align: center;
    padding: 2rem;
    color: var(--text-muted);
}

.empty-history i {
    font-size: 2rem;
    opacity: 0.3;
    margin-bottom: 0.5rem;
    display: block;
}

/* 侧边栏 */
.stock-overview-card {
    background: var(--bg-surface);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.05);
    padding: 1.5rem;
    margin-bottom: 1rem;
    text-align: center;
}

.overview-header {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    font-size: 0.9rem;
    color: var(--text-muted);
    margin-bottom: 1rem;
}

.overview-header i {
    color: var(--color-primary);
}

.total-stock {
    margin-bottom: 0.5rem;
}

.stock-number {
    font-size: 3rem;
    font-weight: 700;
    color: var(--text-main);
}

.stock-unit {
    font-size: 1rem;
    color: var(--text-muted);
    margin-left: 0.25rem;
}

.stock-status {
    display: inline-flex;
    align-items: center;
    gap: 0.35rem;
    padding: 0.35rem 0.85rem;
    border-radius: 20px;
    font-size: 0.85rem;
    margin-bottom: 1rem;
}

.stock-status.normal {
    background: rgba(16, 185, 129, 0.15);
    color: #10b981;
}

.stock-status.low {
    background: rgba(245, 158, 11, 0.15);
    color: #f59e0b;
}

.stock-status.critical {
    background: rgba(239, 68, 68, 0.15);
    color: #ef4444;
}

.stock-bar-lg {
    height: 8px;
    background: rgba(255,255,255,0.1);
    border-radius: 4px;
    overflow: hidden;
}

.bar-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.5s ease;
}

.bar-fill.normal { background: linear-gradient(90deg, #10b981, #34d399); }
.bar-fill.low { background: linear-gradient(90deg, #f59e0b, #fbbf24); }
.bar-fill.critical { background: linear-gradient(90deg, #ef4444, #f87171); }

/* 分仓库存 */
.warehouse-stocks-card, .quick-actions-card {
    background: var(--bg-surface);
    border-radius: 16px;
    border: 1px solid rgba(255,255,255,0.05);
    padding: 1.25rem;
    margin-bottom: 1rem;
}

.warehouse-list {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
}

.warehouse-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    background: rgba(255,255,255,0.03);
    border-radius: 10px;
}

.warehouse-name {
    font-weight: 500;
    color: var(--text-main);
}

.warehouse-location {
    display: block;
    font-size: 0.75rem;
    color: var(--text-muted);
}

.warehouse-qty {
    text-align: right;
}

.qty-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-primary);
}

.qty-unit {
    font-size: 0.75rem;
    color: var(--text-muted);
}

.empty-warehouse {
    text-align: center;
    padding: 1rem;
    color: var(--text-muted);
    font-size: 0.85rem;
}

/* 快捷操作 */
.actions-list {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.quick-action-btn {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 10px;
    color: var(--text-main);
    font-size: 0.9rem;
    cursor: pointer;
    text-decoration: none;
    transition: all 0.3s ease;
}

.quick-action-btn:hover {
    border-color: var(--color-primary);
    background: rgba(99, 102, 241, 0.1);
}

.quick-action-btn i {
    width: 20px;
    text-align: center;
    color: var(--color-primary);
}

.quick-action-btn.danger:hover {
    border-color: #ef4444;
    background: rgba(239, 68, 68, 0.1);
}

.quick-action-btn.danger i {
    color: #ef4444;
}

/* 响应式 */
@media (max-width: 1024px) {
    .detail-grid {
        grid-template-columns: 1fr;
    }
    
    .price-grid {
        grid-template-columns: repeat(2, 1fr);
    }
}

@media (max-width: 640px) {
    .product-card .card-header {
        flex-direction: column;
        text-align: center;
    }
    
    .header-actions {
        width: 100%;
    }
    
    .action-btn {
        width: 100%;
        justify-content: center;
    }
    
    .price-grid {
        grid-template-columns: 1fr;
    }
}

/* ============ 库存调拨模态框 ============ */
.modal-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.8);
    backdrop-filter: blur(12px);
    -webkit-backdrop-filter: blur(12px);
    z-index: 9999;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    visibility: hidden;
    transition: opacity 0.3s ease, visibility 0.3s ease;
}

.modal-overlay.show {
    opacity: 1;
    visibility: visible;
}

.adjust-modal {
    position: relative;
    width: calc(100% - 2rem);
    max-width: 460px;
    max-height: 85vh;
    overflow-y: auto;
    background: var(--bg-surface);
    border-radius: 20px;
    border: 1px solid rgba(99, 102, 241, 0.3);
    box-shadow: 0 0 100px rgba(99, 102, 241, 0.3), 0 30px 80px rgba(0, 0, 0, 0.6);
    transform: scale(0.9) translateY(30px);
    opacity: 0;
    transition: transform 0.35s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
}

.modal-overlay.show .adjust-modal {
    transform: scale(1) translateY(0);
    opacity: 1;
}

.adjust-modal .modal-header {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1.5rem;
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.adjust-modal .modal-icon {
    width: 50px;
    height: 50px;
    background: linear-gradient(135deg, var(--color-primary), #8b5cf6);
    border-radius: 14px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.3rem;
    color: white;
}

.adjust-modal .modal-header h3 {
    flex: 1;
    margin: 0;
    font-size: 1.25rem;
    color: var(--text-main);
}

.modal-close {
    width: 38px;
    height: 38px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(255,255,255,0.05);
    border: none;
    border-radius: 10px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s ease;
}

.modal-close:hover {
    background: rgba(239,68,68,0.2);
    color: #ef4444;
}

.modal-target {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.5rem;
    background: rgba(99, 102, 241, 0.08);
    border-bottom: 1px solid rgba(255,255,255,0.05);
}

.target-label {
    font-size: 0.8rem;
    color: var(--text-muted);
}

.target-name {
    font-weight: 600;
    color: var(--color-primary);
}

.adjust-form {
    padding: 1.5rem;
}

.adjust-form .form-group {
    margin-bottom: 1.25rem;
}

.adjust-form .form-label {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.85rem;
    color: var(--text-muted);
    margin-bottom: 0.5rem;
}

.adjust-form .form-label i {
    color: var(--color-primary);
}

.adjust-form .form-row {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 1rem;
}

.adjust-form .form-input {
    width: 100%;
    padding: 0.85rem 1rem;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: 10px;
    color: var(--text-main);
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.adjust-form .form-input:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px var(--color-primary-glow);
}

.modal-actions {
    display: flex;
    gap: 0.75rem;
    margin-top: 1.5rem;
}

.submit-btn {
    flex: 1;
    padding: 0.85rem;
    background: linear-gradient(135deg, var(--color-primary), #8b5cf6);
    border: none;
    border-radius: 12px;
    color: white;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
}

.submit-btn:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 25px rgba(99, 102, 241, 0.4);
}

.cancel-btn {
    padding: 0.85rem 1.5rem;
    background: transparent;
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 12px;
    color: var(--text-muted);
    cursor: pointer;
    transition: all 0.2s ease;
}

.cancel-btn:hover {
    background: rgba(255,255,255,0.05);
    color: var(--text-main);
}
</style>
{% endblock %}

{% block scripts %}
<script>
const adjustModal = document.getElementById('adjustModal');

function openAdjustModal() {
    adjustModal.classList.add('show');
    document.body.style.overflow = 'hidden';
}

function closeAdjustModal() {
    adjustModal.classList.remove('show');
    document.body.style.overflow = '';
}

// 点击遮罩关闭
adjustModal.addEventListener('click', function(e) {
    if (e.target === this) {
        closeAdjustModal();
    }
});

// ESC 键关闭
document.addEventListener('keydown', function(e) {
    if (e.key === 'Escape') {
        closeAdjustModal();
    }
});

function printBarcode() {
    window.print();
}

function confirmDelete() {
    if (confirm('确定要删除此商品吗？此操作无法撤销。')) {
        // 发送删除请求
        alert('删除功能待实现');
    }
}
</script>
{% endblock %}
